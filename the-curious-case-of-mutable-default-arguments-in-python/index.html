<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>sunu's weblog - On programming and stuff.</title>
    <meta name="description" content="Weblog of Tarashish Mishra; On programming and stuff." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

</head>
<body class="post-template">

    <header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="/">Home</a>
        <a class="subscribe-button icon-feed" href="/rss.xml">Subscribe</a>
    </nav>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <h1 class="post-title">The curious case of mutable default arguments in Python</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2014-11-25">25 Nov 2014</time>
                
                    on <a href="/tag/programmin/" rel="tag">programmin</a>, <a href="/tag/python/" rel="tag">python</a>
                
            </section>
        </header>

<!--         <header class="post-header">
            <a id="blog-logo" href="sunu.in">
                
                    <span class="blog-title">sunu's weblog</span>
                
            </a>
        </header> -->

        <!-- <span class="post-meta">
            <time datetime="2014-11-25">25 Nov 2014</time>
            
        </span> -->

        <!-- <h1 class="post-title">The curious case of mutable default arguments in Python</h1> -->

        <section class="post-content">
            <p>Python&#39;s handing of default arguments trips up most Pythonistas at some point in their journey. Sometimes it makes people pull out their hair in frustration because they can&#39;t figure out what&#39;s wrong.</p>

<p>Consider the following example.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bar</span>
</code></pre></div>
<p>One would expect the function <code>foo</code> to return the list <code>[1]</code> every time it is called. And the result will take them by total surprise.</p>

<p>Let&#39;s try calling the function multiple times.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div>
<p>That&#39;s certainly not what we expected the function <code>foo</code> to return. Turns out the list gets bigger and bigger each time we call the function.</p>

<p>Let&#39;s take a deeper look. We&#39;ll use the built-in funtion <code>id</code> which returns the unique identity of an object. For example:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="mi">13979728</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="mi">13979728</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="bp">True</span>
</code></pre></div>
<p>Here id of a and b are same since they refer to the same object, the integer 12. Similarly</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="bp">True</span>
</code></pre></div>
<p>This explains why our issue. The function keeps using the same list everytime it&#39;s called. Which means we are appending 1 to the same list everytime we call the function. That&#39;s why the list keeps getting bigger.</p>

<hr>

<h3>Why does this happen?</h3>

<p>The reason default arguments work this way is that fuctions are first class objects in Python. And they are treated like other first class objects, not as just some piece of code.</p>

<p>Function definition is an executable statement in Python. The default arguments are initialized only once (during the execution of the funtion definition). No more initialization is done for subsequent function executions.</p>

<hr>

<h3>What&#39;s the solution?</h3>

<p>The solution to the above example is to use <code>None</code> as the default argument.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python">    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">bar</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Do your stuff here.</span>
</code></pre></div>
<hr>

<h3>Thanks for reading</h3>

<p>Thanks for taking time to read this post. Hope you found it interesting. There are some cool things you can do by taking advantage of mutable default arguments. Go through the <a href="#links">links section</a> if you want to learn more.</p>

<h3>Links</h3>

<ul>
<li><a href="http://docs.python-guide.org/en/latest/writing/gotchas/">Common gotchas in Python</a></li>
<li><a href="http://effbot.org/zone/default-values.htm">Must-read article about default arguments by Effbot</a></li>
<li><a href="http://stackoverflow.com/questions/1132941/least-astonishment-in-python-the-mutable-default-argument">Question on StackOverflow</a></li>
</ul>

        </section>

        

        <footer class="post-footer">
            <!-- If we want to display author's name and bio -->
            
                <figure class="author-image">
                    <a class="img" href="/" style="background-image: url(/assets/images/profile.jpeg)">
                    <span class="hidden">Tarashish Mishra's Picture</span></a>
                </figure>
                <section class="author">
                    <!-- Author Name -->
                    <h4> Tarashish Mishra </h4>
                    <!-- Author Bio -->
                    <p>
                        Hi, I'm sunu.
                        I'm a programmer. I like Python, travelling and animated cat/dog pictures. This blog is about my adventures and experience with code, travel and life. Contact me via <a href="mailto:sunu@sunu.in">mail</a>, <a href="https://twitter.com/tarashish">Twitter</a> or <a href="https://github.com/sunu">Github</a>.
                    </p>
                </section>
            

            <!-- Share links section -->
            <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?text=The curious case of mutable default arguments in Python&amp;url=http://sunu.in/the-curious-case-of-mutable-default-arguments-in-python"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://sunu.in/the-curious-case-of-mutable-default-arguments-in-python"
        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://sunu.in/the-curious-case-of-mutable-default-arguments-in-python"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>


            <!-- Disqus comments -->
            
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">

        var disqus_shortname = 'sunuin';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            

        </footer>

    </article>

</main>

    <footer class="site-footer clearfix">
      <section class="copyright">
        <a href="/">sunu's weblog</a> &copy; 
               &bull; All rights reserved.
      </section>
      <section class="poweredby">Made with Jekyll using 
        <a href="http://github.com/rosario/kasper">Kasper theme</a>
      </section>
    </footer>
    
    <script type="text/javascript" src="/assets/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-XXXXXXXX-X']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>   
</body>
</html>
