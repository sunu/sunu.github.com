<!DOCTYPE html>
<html lang="en">
<head>
          <title>sunu's weblog</title>
        <meta charset="utf-8" />
        <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="sunu's weblog Atom Feed" />



    <meta name="tags" content="python" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">sunu's weblog <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/about/">about</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/the-curious-case-of-mutable-default-arguments-in-python/" rel="bookmark"
         title="Permalink to The curious case of mutable default arguments in Python">The curious case of mutable default arguments in Python</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-11-25T09:12:00+05:30">
      Tue 25 November 2014
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="/author/tarashish-mishra.html">Tarashish Mishra</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Python's handing of default arguments trips up most Pythonistas at some point in their journey. Sometimes it makes people pull out their hair in frustration because they can't figure out what's wrong.</p>
<p>Consider the following example.</p>
<div class="highlight"><pre><span></span>    def foo(bar=[]):
        bar.append(1)
        return bar
</pre></div>


<p>One would expect the function <code>foo</code> to return the list <code>[1]</code> every time it is called. And the result will take them by total surprise.</p>
<p>Let's try calling the function multiple times.</p>
<div class="highlight"><pre><span></span>    &gt;&gt;&gt; foo()
    [1]
    &gt;&gt;&gt; foo()
    [1, 1]
    &gt;&gt;&gt; foo()
    [1, 1, 1]
</pre></div>


<p>That's certainly not what we expected the function <code>foo</code> to return. Turns out the list gets bigger and bigger each time we call the function.</p>
<p>Let's take a deeper look. We'll use the built-in funtion <code>id</code> which returns the unique identity of an object. For example:</p>
<div class="highlight"><pre><span></span>    &gt;&gt;&gt; a = 12
    &gt;&gt;&gt; b = 12
    &gt;&gt;&gt; id(a)
    13979728
    &gt;&gt;&gt; id(b)
    13979728
    &gt;&gt;&gt; id(a) == id(b)
    True
</pre></div>


<p>Here id of a and b are same since they refer to the same object, the integer 12. Similarly</p>
<div class="highlight"><pre><span></span>    &gt;&gt;&gt; a = foo()
    &gt;&gt;&gt; a
    [1]
    &gt;&gt;&gt; b = foo()
    &gt;&gt;&gt; b
    [1, 1]
    &gt;&gt;&gt; id(a) == id(b)
    True
</pre></div>


<p>This explains why our issue. The function keeps using the same list everytime it's called. Which means we are appending 1 to the same list everytime we call the function. That's why the list keeps getting bigger.</p>
<hr />
<h3>Why does this happen?</h3>
<p>The reason default arguments work this way is that fuctions are first class objects in Python. And they are treated like other first class objects, not as just some piece of code.</p>
<p>Function definition is an executable statement in Python. The default arguments are initialized only once (during the execution of the funtion definition). No more initialization is done for subsequent function executions.</p>
<hr />
<h3>What's the solution?</h3>
<p>The solution to the above example is to use <code>None</code> as the default argument.</p>
<div class="highlight"><pre><span></span>    def foo(bar=None):
        if bar is None:
            bar = []
        # Do your stuff here.
</pre></div>


<hr />
<h3>Thanks for reading</h3>
<p>Thanks for taking time to read this post. Hope you found it interesting. There are some cool things you can do by taking advantage of mutable default arguments. Go through the <a href="#links">links section</a> if you want to learn more.</p>
<h3>Links</h3>
<ul>
<li><a href="http://docs.python-guide.org/en/latest/writing/gotchas/">Common gotchas in Python</a></li>
<li><a href="http://effbot.org/zone/default-values.htm">Must-read article about default arguments by Effbot</a></li>
<li><a href="http://stackoverflow.com/questions/1132941/least-astonishment-in-python-the-mutable-default-argument">Question on StackOverflow</a></li>
</ul>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>